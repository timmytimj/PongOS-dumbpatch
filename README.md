messy messy messy, loop patched bad var declarations
